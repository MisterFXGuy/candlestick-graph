<!DOCTYPE html>

<html lang="en">
    <head>
        <title>Simple rates graph</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://rawgithub.com/mrpoulin/oandajs/update/oanda.js"></script>
        <script src="https://www.google.com/jsapi"></script>
        <script src="./candlestickChart.js"></script>

        <script>

            google.load("visualization", "1", {packages:["corechart"]});

            $('document').ready( function() {

                   var chart = new OCandlestickChart('EUR_USD', 'M30', document.getElementById('chart'));

                   //Will run chart with default values.
                   google.setOnLoadCallback(function() { chart.render() });

                    //Populate the granularity select box:
                    for(var i = 0; i < GranularityTable.granularities.length; i++) {
                        gran = GranularityTable.granularities[i];
                        $('#granularitySelector').append($('<option>', { text : gran, value : gran }))
                        $('#granularitySelector').val('M30');
                    }

                    //Populate the instrument select box:
                    OANDA.rate.instruments(['instrument'], function(response) {
                        for(var i = 0; i < response.instruments.length; i++) {
                            var instrument = response.instruments[i].instrument;
                            $('#instrumentSelector').append($('<option>', { value : instrument, text : instrument }));
                        }
                        //Make sure an instrument is set and everything is ready to go:
                        $('#instrumentSelector').val('EUR_USD');
                    });
                    
                    $('#instrumentSelector').change( function() {
                        chart.changeInstrument($('#instrumentSelector').val());
                    });

                    $('#granularitySelector').change(function() {
                        chart.changeGranularity($('#granularitySelector').val());
                    });
            });
        </script>

        <style>
            #chart {
                overflow-x:auto;
                overflow-y:hidden;
            }
        </style>
    </head>

    <body>
        <form>
            <label for="instrumentSelector">Instrument Selector:</label>
            <select id="instrumentSelector"></select>
            <label for="granularitySelector">Granularity Selector:</label>
            <select id="granularitySelector"></select>
        <div id='chart'>
        </div>
    </body>

</html>

